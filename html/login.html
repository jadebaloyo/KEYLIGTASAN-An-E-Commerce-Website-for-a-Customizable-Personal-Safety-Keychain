<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - KEYLIGTASAN</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../css/login-new.css">
</head>
<body>
    
    <div class="login-container">
        
        <!-- Left Side - Dark Background with Branding -->
        <div class="left-side">
            <div class="background-circle"></div>
            
            <div class="left-content">
                <div class="logo">
                    <i class="fas fa-key"></i>
                </div>
                
                <h1 class="brand-name">KEYLIGTASAN</h1>
                
                <h2 class="welcome-text">Welcome Back!</h2>
                
                <p class="tagline">Login to access your account and manage your orders</p>
                
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure & Safe</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-lock"></i>
                        <span>Encrypted Data</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-user-check"></i>
                        <span>Verified Users</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Side - White Form Area -->
        <div class="right-side">
            <div class="form-wrapper">
                
                <!-- Back to Home Link -->
                <a href="homepage_index.html" class="back-home">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Home</span>
                </a>
                
                <!-- Form Header -->
                <div class="form-header">
                    <h2>Login to Your Account</h2>
                    <p>Enter your credentials to access your account</p>
                </div>
                
                <!-- Alert Message -->
                <div class="alert" style="display: none;"></div>
                
                <!-- Login Form -->
                <form id="loginForm">
                    
                    <!-- Email Field -->
                    <div class="input-group">
                        <label for="email">
                            <i class="fas fa-user"></i>
                            Email or Username
                        </label>
                        <input 
                            type="text" 
                            id="email" 
                            name="email"
                            placeholder="Enter your email or username"
                        >
                    </div>
                    
                    <!-- Password Field -->
                    <div class="input-group">
                        <label for="password">
                            <i class="fas fa-lock"></i>
                            Password
                        </label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                id="password" 
                                name="password"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            >
                            <button type="button" class="toggle-password" onclick="togglePassword()">
                                <i class="fas fa-eye" id="toggleIcon"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Remember Me & Forgot Password -->
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" id="rememberMe">
                            <span>Remember me</span>
                        </label>
                        <a href="forgot-password.html" class="forgot-password">Forgot Password?</a>
                    </div>
                    
                    <!-- Login Button -->
                    <button type="submit" class="btn-login">
                        Login
                    </button>
                    
                    <!-- Divider -->
                    <div class="divider">
                        <span>OR</span>
                    </div>
                    
                    <!-- Google Login -->
                    <button type="button" class="btn-google">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>
                    
                    <!-- Register Link -->
                    <p class="signup-text">
                        Don't have an account? <a href="register.html">Sign up</a>
                    </p>
                    
                </form>
                
            </div>
        </div>
        
    </div>
    
    <!-- JavaScript -->
    <script>
    console.log('‚úÖ KEYLIGTASAN Login Script Loaded');
    
    // Toggle password visibility
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('toggleIcon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        }
    }
    
    // Show alert message
    function showAlert(type, message) {
        let alertBox = document.querySelector('.alert');
        
        if (!alertBox) {
            alertBox = document.createElement('div');
            alertBox.className = 'alert';
            const formHeader = document.querySelector('.form-header');
            formHeader.insertAdjacentElement('afterend', alertBox);
        }
        
        alertBox.className = 'alert alert-' + type;
        alertBox.innerHTML = '<i class="fas fa-' + (type === 'success' ? 'check' : 'exclamation') + '-circle"></i> <span>' + message + '</span>';
        alertBox.style.display = 'flex';
        alertBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    
    // Handle form submission
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('loginForm');
        
        if (!form) {
            console.error('‚ùå Form not found!');
            return;
        }
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('üîÑ Form submitted');
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            // Validation
            if (!email) {
                showAlert('error', 'Please enter your email or username');
                return;
            }
            
            if (!password) {
                showAlert('error', 'Please enter your password');
                return;
            }
            
            // Get button and show loading
            const btn = document.querySelector('.btn-login');
            const originalText = btn.textContent;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            btn.disabled = true;
            
            // Prepare data
            const loginData = {
                email: email,
                password: password
            };
            
            /*
             * ===========================================
             * PATH TO LOGIN.PHP
             * ===========================================
             * login.html is in: html/ folder
             * login.php is in:  php/config/ folder
             * 
             * From html/ folder:
             *   ../php/config/login.php
             * ===========================================
             */
            const loginUrl = '../php/config/login.php';
            
            console.log('üì§ Sending to:', loginUrl);
            
            // Send request
            fetch(loginUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(loginData)
            })
            .then(response => {
                console.log('üì• Response:', response.status);
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('‚úÖ Data:', data);
                
                if (data.success) {
                    // Save to sessionStorage
                    sessionStorage.setItem('isLoggedIn', 'true');
                    sessionStorage.setItem('userId', data.user.id);
                    sessionStorage.setItem('userEmail', data.user.email);
                    sessionStorage.setItem('userName', data.user.full_name);
                    sessionStorage.setItem('userRole', data.user.role);
                    
                    showAlert('success', '‚úÖ Login successful! Redirecting...');
                    
                    /*
                     * ===========================================
                     * REDIRECT PATHS
                     * ===========================================
                     * login.html is in:               html/ folder
                     * admin_dashboard.html is in:     admin/ folder
                     * customer/dashboard.html is in:  customer/ folder
                     * 
                     * From html/ folder:
                     *   Admin:    ../admin/admin_dashboard.html
                     *   Customer: ../customer/dashboard.html
                     * ===========================================
                     */
                    setTimeout(function() {
                        if (data.user.role === 'admin') {
                            console.log('üîÄ Redirecting to ADMIN dashboard');
                            window.location.href = '../admin/admin_dashboard.html';
                        } else {
                            console.log('üîÄ Redirecting to CUSTOMER dashboard');
                            window.location.href = '../customer/dashboard.html';
                        }
                    }, 1500);
                    
                } else {
                    showAlert('error', data.message || 'Login failed');
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            })
            .catch(error => {
                console.error('üí• Error:', error);
                
                let msg = 'Connection error';
                if (error.message.includes('404')) {
                    msg = '‚ùå login.php not found! Put it in php/config/ folder';
                } else if (error.message.includes('Failed to fetch')) {
                    msg = '‚ùå Server not reachable. Is XAMPP running?';
                } else {
                    msg = '‚ùå Error: ' + error.message;
                }
                
                showAlert('error', msg);
                btn.textContent = originalText;
                btn.disabled = false;
            });
        });
    });
    </script>
    
</body>
</html>